# GpxSplits

This is Python package/command line tool for for getting split times from GPX files. It also creates some visualizations of the split times.

This is intended as a training tool and to help analyze personal performance. Accuracy of the generated split times will be dependent on the accuracy of the GPX file(s) and may not be suitable for race timing.

## Installation

To install this library you will need to use the command line. Open the command line within the folder you wish to save the library to.

Clone a copy of this repository to your local computer using git. For more info see *[the git simple guide](https://rogerdudler.github.io/git-guide/*).

`git clone https://github.com/BorehamN/GpxSplits`

Once the library has been downloaded install the requirements using the command

`pip install -r requirements.txt`

Then we can install the library using the command

`python setup.py install`

You can check the library has been installed by running

`gpxsplits --help`

This will show some brief help information.

## Getting Split times

Split times are generated by running the command line tool in the form:

`gpxsplits COURSE_FILE GPX_FILE`

The rest of this section will explain this in more detail.

To generate split times we need two files:
1. A course file
2. A GPX file

The later sections of this document explain these file formats in more detail but for now we can use the ones supplied in the library's data directory.

Open the command line in the data directory. We can generate splits for the `Lipno_Classic_1.gpx` by running the following in the command line:

`gpxsplits mySplits Lipno_splits.json Lipno_Classic_1.gpx`

This will produce 4 files in this directory:
- `mySplits_splits.csv` - Splits times in seconds
- `mySplits_splits.html` - A plot of the split times
- `mySplits_normalised_splits.csv` - The normalised split times as +/- from the average time.
- `mySplits_splits.html` - A plot of the normalised split times as +/- from the average time.

To compare GPX files multiple gpx files can be specified at the end of the command:

`gpxsplits mySplits Lipno_splits.json Lipno_Classic_1.gpx Lipno_Classic_2.gpx`

Alternatively the unix wild card characters can be used to select multiple files. For instance the following command selects all GPX files in a directory:

`gpxsplits mySplits Lipno_splits.json *.gpx`

## The Course File

The course file follows the (JSON Format)[https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/JSON].

The course file must have a `name` field which is a string specifying the name of the course and a `course` field which contains a list of gates.

Gates are JSON objects which must contain a unique `name` field. The `left` and `right` fields of the gate specify the points of left and right hand sides of the gate. These points should be given as a list specifying longitude then latitude *i.e* `[longitude, latitude]`. All longitude and latitude values should be given in degrees with reference to the WGS84 datum.

Gates are one-way only so care should be given to ensure they are specified the correct way round. The left and the right hand sides of the gate are defined relative to the direction of travel of the GPS receiver. Therefore as you approach a gate, the left hand point of the gate should be on your left, and the right hand gate to your right. If this is reversed the split time will not be recorded.

An example course file is shown bellow, or you can refer to `./data/Lipno_splits.json`. Currently course files must be made by hand using a plain text editor, but I would like to make a tool to do this in the future.

```
{
    "name": "Demo Course FIle",
    "course": [
        {
            "name": "Example Gate 1",
            "left":  [<longitude degrees>, <latitude degrees>],
            "right": [<longitude degrees>, <latitude degrees>]
        },
        {
            "name": "Example Gate 2",
            "left":  [14.243294097546908, 48.621806226585164],
            "right": [14.242755885244975, 48.621867754696126]
        }
    ]
}
```

## GPX to CSV

In addition to the `gpxsplits` command, the library also features a tool to convert a GPX file to a CSV format so that it can be easily analyzed using external tools. This can is run in the command line in a similar fashion:

`gpxtocsv Lipno_Classic_1.gpx`

This will create a new file in the same directory `Lipno_Classic_1.csv` with the columns:
- lat
- lon
- elev
- epoch
- temp
- hr

Again mulitple files or unix wildcard characters can be used to convert multiple files at once/

`gpxtocsv *.gpx`

## How to Download a GPX file from Strava

The (GPX file format)[https://en.wikipedia.org/wiki/GPS_Exchange_Format] is a standard open format that can be downloaded from most GPS/GNSS devices. However here we will only cover how to download it from (Strava)[https://www.strava.com] as this is commonly used my most sport enthusiasts.

Unfortunately you can only download the GPX file of your own past Strava activities from the desktop site.

1. Login to https://www.strava.com
2. Navigate to the activity you wish to download (a list of your past activities can be found here https://www.strava.com/athlete/training)
3. Download the GPX file using either the button on the interactive map or by using the `Export GPX` button under the options (three dots `...`) menu.
4. Rename and move the file to an appropriate location. `gpxsplits` will use this filename to identify split times from this GPX file.

## Improvements

- A tool to create the course file
- Remove shapely dependancy
- Calculate gate intecept in cartesian East-North rather than current geographic coords.
- Additional data visualisations
